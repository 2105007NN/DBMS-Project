--creation of tables
--DROP TABLE ADDRESS;
--DROP TABLE PRODUCT_CATEGORY;
CREATE TABLE ADDRESS (
    ADDRESS_ID INT CONSTRAINT ADDRESS_PK PRIMARY KEY,
    STREET VARCHAR2(255),
    CITY VARCHAR2(50),
    COUNTRY VARCHAR2(30),
    POSTAL_CODE VARCHAR2(20)
);

CREATE TABLE PRODUCT_CATEGORY (
    CATEGORY_ID INT CONSTRAINT PRODUCT_CAT_PK PRIMARY KEY,
    CATEGORY_NAME VARCHAR2(50),
    PARENT_CATEGORY_ID INT,
    CONSTRAINT PARENT_CAT_FK FOREIGN KEY (PARENT_CATEGORY_ID) REFERENCES PRODUCT_CATEGORY(CATEGORY_ID)
);

CREATE TABLE PRODUCT (
    PRODUCT_ID INT CONSTRAINT PRODUCT_PK PRIMARY KEY,
    STOCK_QUANTITY INT,
    PRODUCT_PRICE NUMBER(10,2),
    PRODUCT_DESCRIPTION VARCHAR2(1000),
    PRODUCT_CATEGORY_ID INT NOT NULL,
    CONSTRAINT PRODUCT_CAT_FK FOREIGN KEY (PRODUCT_CATEGORY_ID) REFERENCES PRODUCT_CATEGORY(CATEGORY_ID)
);

CREATE TABLE ADMIN (
    ADMIN_ID INT CONSTRAINT ADMIN_PK PRIMARY KEY,
    ADMIN_NAME VARCHAR2(50),
    ADMIN_ROLE VARCHAR2(30),
    PASSWORD VARCHAR2(30)
);

CREATE TABLE SUPPLIER (
    SUPPLIER_ID INT CONSTRAINT SUPPLIER_PK PRIMARY KEY,
    SUPPLIER_NAME VARCHAR2(50),
    SUPPLIER_STATUS VARCHAR2(50),
    EMAIL VARCHAR2(50),
    CONTACT_NO VARCHAR2(20),
    WEBSITE_URL VARCHAR2(255),
    ADMIN_ID INT,
    ADDRESS_ID INT,
    CONSTRAINT ADMIN_SUPPLIER_FK FOREIGN KEY (ADMIN_ID) REFERENCES ADMIN(ADMIN_ID),
    CONSTRAINT ADDRESS_SUPPLIER_FK FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ADDRESS_ID)
);

CREATE TABLE CUSTOMER (
    CUSTOMER_ID INT CONSTRAINT CUSTOMER_PK PRIMARY KEY,
    FIRST_NAME VARCHAR2(50),
    LAST_NAME VARCHAR2(50),
    CONTACT_NO VARCHAR2(20),
    EMAIL VARCHAR2(50),
    PASSWORD VARCHAR2(255),
    ADDRESS_ID INT,
    CONSTRAINT ADDRESS_CUSTOMER_FK FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ADDRESS_ID)
);

CREATE TABLE CART (
    CART_ID INT CONSTRAINT CART_PK PRIMARY KEY,
    CREATION_TIME TIMESTAMP,
    CUSTOMER_ID INT NOT NULL,
    CONSTRAINT CUSTOMER_CART_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID)
);

CREATE TABLE RATING (
    RATING_ID INT CONSTRAINT RATING_PK PRIMARY KEY,
    RATING_VALUE NUMBER(2,1),
    COMMENTS VARCHAR2(1000),
    REVIEW_DATE DATE,
    CUSTOMER_ID INT NOT NULL,
    PRODUCT_ID INT NOT NULL,
    CONSTRAINT CUSTOMER_RATING_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID),
    CONSTRAINT PRODUCT_RATING_FK FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID)
);

CREATE TABLE ORDERS (
    ORDER_NO INT CONSTRAINT ORDER_PK PRIMARY KEY,
    PAYMENT_MODE VARCHAR2(100),
    ORDER_DATE DATE,
    PAYMENT_AMOUNT NUMBER(10,2),
    ADDRESS_ID INT NOT NULL,
    CUSTOMER_ID INT NOT NULL,
    CONSTRAINT ADDRESS_ORDER_FK FOREIGN KEY (ADDRESS_ID) REFERENCES ADDRESS(ADDRESS_ID),
    CONSTRAINT CUSTOMER_ORDER_FK FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID)
);

CREATE TABLE SHIPPING_DETAILS (
    TRACKING_ID INT CONSTRAINT SHIPPING_DETAILS_PK PRIMARY KEY,
    COURIER_NAME VARCHAR2(255),
    ORDER_STATUS VARCHAR2(255),
    ORDER_ID INT NOT NULL,
    CONSTRAINT ORDER_SHIPPINGDETAILS_FK FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_NO)
);

CREATE TABLE COUPON (
    REDEEM_CODE VARCHAR2(255) CONSTRAINT COUPON_PK PRIMARY KEY,
    COUPON_NAME VARCHAR2(255),
    DISCOUNT_PCT NUMBER(3,2),
    ORDER_NO INT,
    CUSTOMER_ID INT,
    CONSTRAINT ORDER_COUPON_PK FOREIGN KEY (ORDER_NO) REFERENCES ORDERS(ORDER_NO),
    CONSTRAINT CUSTOMER_COUPON_PK  FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID)
);

CREATE TABLE CART_PRODUCT (
    CART_ID INT,
    PRODUCT_ID INT,
    QUANTITY INT,
    CONSTRAINT CART_PRODUCT_PK PRIMARY KEY (CART_ID, PRODUCT_ID),
    CONSTRAINT CART_CARTPRODUCT_FK FOREIGN KEY (CART_ID) REFERENCES CART(CART_ID),
    CONSTRAINT PRODUCT_CARTPRODUCT_FK FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID)
);

CREATE TABLE ORDER_PRODUCT (
    ORDER_ID INT,
    PRODUCT_ID INT,
    QUANTITY INT,
    CONSTRAINT ORDER_PRODUCT_PK PRIMARY KEY (ORDER_ID, PRODUCT_ID),
    CONSTRAINT ORDER_ORDERPRODUCT_FK  FOREIGN KEY (ORDER_ID) REFERENCES ORDERS(ORDER_NO),
    CONSTRAINT PRODUCT_ORDERPRODUCT_FK  FOREIGN KEY (PRODUCT_ID) REFERENCES PRODUCT(PRODUCT_ID)
);

ALTER TABLE CUSTOMER
MODIFY PASSWORD VARCHAR2(255);

alter table customer
add constraint unique_email UNIQUE(email);

alter table product add product_name varchar2(255);

alter table product add product_img varchar2(255);
